{% extends "main_frame.html" %}
{% block conten_body %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/tree_style.css') }}" />
	<div class="user_info_div" style="color:#000000;margin-top: 0;height: 100%;width: 100%;">
        <h2 class="title">用户信息</h2>
        <div class="tree well" id="user_info_tree">
        	<ul>
		        <li>
		            <div class="btn btn-primary"><i class="glyphicon glyphicon-user"></i> 当前用户: {{ username }} </div>
		            <ul>
		                <li>
		                	<span class="btn btn-success"><i class="glyphicon glyphicon-plus-sign"></i> 密 码 管 理 </span>
		                    <ul>
		                        <li style="display:none;">
			                        <div><span class="btn btn-info"><i class="glyphicon glyphicon-exclamation-sign"></i> 当前密码 </span> <input type="password" name="initial_password" id="initial_password" placeholder="请输入初始密码" required="required"/></div>
		                        </li>
								<li style="display:none;">
									<div><span class="btn btn-info"><i class="glyphicon glyphicon-exclamation-sign"></i> 新密码　 </span> <input type="password" name="initial_password" id="initial_password" placeholder="请输入新密码" required="required"/></div>
		                        </li>
								<li style="display:none;">
									<div><span class="btn btn-info"><i class="glyphicon glyphicon-exclamation-sign"></i> 重复密码 </span> <input type="password" name="initial_password" id="initial_password" placeholder="请重复输入新密码" required="required"/></div>
		                        </li>
		                    </ul>
		                </li>
		                <li>
		                	<span class="btn btn-success"><i class="glyphicon glyphicon-minus-sign"></i> 节 点 管 理 </span>
		                    <ul id="terminal_list">
		                    </ul>
		                </li>
		            </ul>
		        </li>
		    </ul>
        </div>
	</div>
{% endblock %}

{% block script %}
	<script type="text/javascript">
	$(function(){
	    $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Collapse this branch');
	    $('.tree li.parent_li > span').on('click', function (e) {
	        var children = $(this).parent('li.parent_li').find(' > ul > li');
	        if (children.is(":visible")) {
	            children.hide('fast');
	            $(this).attr('title', 'Expand this branch').find(' > i').addClass('glyphicon-plus-sign').removeClass('glyphicon-minus-sign');
	        } else {
	            children.show('fast');
	            $(this).attr('title', 'Collapse this branch').find(' > i').addClass('glyphicon-minus-sign').removeClass('glyphicon-plus-sign');
	        }
	        e.stopPropagation();
	    });
	});
	</script>
	
	<script type=text/javascript>
	
	function creat_sensor_li(sensor){
		var sensor_info_ul = $("<ul></ul>").append($("<li></li>").append('<div><span><i class="glyphicon glyphicon-list"></i> 传感器类型 </span> <input type="text" required="required" value="' + sensor["SensorType"] + '"/></div>'));
		sensor_info_ul.append($("<li></li>").append('<div><span><i class="glyphicon glyphicon-list"></i> 显示名称　 </span> <input type="text" required="required" value="' + sensor["DisplayName"] + '"/></div>'));
		sensor_info_ul.append($("<li></li>").append('<div><span><i class="glyphicon glyphicon-list"></i> 单位　　　 </span> <input type="text" required="required" value="' + sensor["QuantityUnit"] + '"/></div>'));
		var sensor_li = $("<li></li>").append($('<span class="btn btn-info"><i class="glyphicon glyphicon-minus-sign"></i> ' + sensor["DisplayName"] + ' </span>'));
		sensor_li.append(sensor_info_ul);
		return sensor_li;
	}
	
	function creat_terminal_li(index,address,place,sensors){
		var terminal_info_ul = $("<ul></ul>").append($("<li></li>").append('<div><span><i class="glyphicon glyphicon-list"></i> 地址 </span> <input type="text" required="required" value="' + address.toString() + '"/></div>'));
		terminal_info_ul.append($("<li></li>").append('<div><span><i class="glyphicon glyphicon-list"></i> 位置  </span> <input type="text" required="required" value="' + place.toString() + '"/></div>'));
		for(var sensor_index in sensors){
			var sensor = sensors[sensor_index];
			terminal_info_ul.append(creat_sensor_li(sensor));
		}
		var terminal_li = $("<li></li>").append($('<span class="btn btn-warning"><i class="glyphicon glyphicon-minus-sign"></i> 传感器节点' + index.toString() + '</span>'));
		terminal_li.append(terminal_info_ul);
		return terminal_li;
	}
	
	function generate_terminals_li_DOM(terminals){
		for(var terminal_index in terminals){
			var terminal = terminals[terminal_index];
			$("#terminal_list").append(creat_terminal_li(terminal_index, terminal["Address"], terminal["Place"], terminal["SensorList"]));
		}
	}
	
	{% autoescape false %}
		{% if terminals %}
			var terminals = {{ terminals }};
			generate_terminals_li_DOM(terminals);
		{% endif %}
	{% endautoescape %}
	</script>
{% endblock %}